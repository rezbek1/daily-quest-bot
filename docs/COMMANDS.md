# 🎮 Справочник команд и сценариев использования

## Часть 1: Полный список команд бота

### УРОВЕНЬ 1: Базовые команды (Неделя 1)

#### /start
**Описание:** Инициализация бота, регистрация пользователя  
**Параметры:** нет  
**Ответ бота:**
```
🎮 Добро пожаловать в "Повседневный квест"! ⚔️

Ты только что начал эпическое путешествие, где каждая 
обычная задача становится захватывающим квестом!

Уровень: 1 | XP: 0/300
Статус: Новичок 🌟

Что ты можешь делать:
📝 /addtask [описание] — создать новый квест
📋 /quests — посмотреть текущие квесты
✅ /done [номер] — отметить квест выполненным
👤 /profile — профиль и статистика
❓ /help — справка

Давай начнём! Создай свой первый квест:
/addtask Сходить в магазин
```

**Сохранение данных:**
- Создать документ пользователя в Firebase
- Сохранить: Telegram ID, username, имя, дата регистрации
- Инициализировать: level=1, xp=0, streak=0
- Первый бейдж: "Первый шаг" (за нажатие /start)

---

#### /addtask [описание]
**Описание:** Добавить новую задачу и сгенерировать для нее сюжет  
**Параметры:** `описание` (текст 5-200 символов)  
**Примеры использования:**
```
/addtask Сходить в магазин
/addtask Позвонить маме
/addtask Помыть посуду
/addtask Написать отчет для начальника
```

**Процесс:**
1. Валидация текста (не пусто, не более 200 символов)
2. Обращение к ChatGPT с промптом
3. Обработка результата
4. Сохранение в Firebase
5. Ответ пользователю

**Ответ при успехе:**
```
✅ Квест создан!

📜 КВЕСТ #1: Поиск припасов
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Ты — отважный искатель припасов! В лесу бушует метель, 
а в твоей деревне заканчиваются запасы. Отправляйся в 
ближайший торговый пост и принеси еду для выживания.

Королевский совет ждет!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💰 Награда: +15 XP
⏱️ Время: до конца дня
Сложность: ⭐⭐

[Выполнено] [Отмена]
```

**Возможные ошибки:**
```
❌ Ошибки валидации:
"Пожалуйста, опиши задачу (от 5 до 200 символов)"

❌ Timeout ChatGPT:
"Генерирую... может занять 5-10 сек... ⏳"
[После повтора или таймаута]
"📝 Квест создан автоматически:
Выполни задачу: Сходить в магазин"

❌ Нежелательный контент в генерации:
"Произошла ошибка при генерации. Попробуй другое описание."
```

---

#### /quests
**Описание:** Показать все активные квесты пользователя  
**Параметры:** нет  
**Ответ:**
```
📋 ТВ ТЕКУЩИЕ КВЕСТЫ (3)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1️⃣ 📜 Поиск припасов
   Описание: Сходить в магазин
   Награда: 15 XP ⏱️ до конца дня
   [Выполнено] [Деталь] [Отмена]

2️⃣ 📜 Магическая уборка
   Описание: Помыть посуду
   Награда: 10 XP ⏱️ до конца дня
   [Выполнено] [Деталь] [Отмена]

3️⃣ 📜 Призыв матери
   Описание: Позвонить маме
   Награда: 20 XP ⏱️ до конца дня
   [Выполнено] [Деталь] [Отмена]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 Совет: выполни 3+ квеста сегодня, чтобы получить 
бонус +10 XP за активность!

[Добавить новый] [Профиль]
```

**Кейсы:**
```
Если нет квестов:
"📭 У тебя нет активных квестов!
Создай первый квест командой:
/addtask Описание твоей задачи"

Если есть выполненные:
"Выполненные квесты (2)
1. ✅ Магическая уборка — +10 XP
2. ✅ Поиск припасов — +15 XP
[Показать новые] [Скрыть выполненные]"
```

---

#### /done [номер]
**Описание:** Отметить квест как выполненный  
**Параметры:** `номер` — 1, 2, 3... или название квеста  
**Примеры:**
```
/done 1
/done 2
/done Поиск припасов
```

**Процесс:**
1. Найти квест по номеру или названию
2. Проверить, что не выполнен еще
3. Обновить статус в Firebase
4. Добавить XP пользователю
5. Проверить, повышается ли уровень
6. Обновить streak (дни подряд)
7. Проверить достижения (badges)

**Ответ:**
```
🎉 КВЕСТ ВЫПОЛНЕН!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📜 Поиск припасов
"Ты успешно добыл припасы для деревни. Королева довольна!"

✨ +15 XP за выполнение!

📊 Твой прогресс:
   Уровень 1: 45/300 XP (15%)
   Всего выполнено сегодня: 3/3
   🔥 Streak: 7 дней подряд!

🏆 НОВЫЙ БЕЙДЖ: "Неутомимый" (7 дней подряд)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Ещё 1 квест до +10 XP бонуса за активность!

[Добавить новый] [Мой прогресс]
```

**Ошибки:**
```
❌ /done 5
"❌ Квеста #5 не найдено. Активных квестов: 3"

❌ /done (повторный клик)
"✅ Этот квест уже выполнен! 
   Выполненные квесты:
   - Магическая уборка (+10 XP)"
```

---

#### /profile
**Описание:** Показать профиль и статистику пользователя  
**Параметры:** нет  
**Ответ:**
```
👤 ПРОФИЛЬ: Алекс
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 ОСНОВНЫЕ СТАТИСТИКИ
Уровень: 3 ⭐⭐⭐
Опыт: 240/300 XP (80%)
[████████░] (прогресс бар)

📈 ПРОГРЕСС
✅ Всего квестов: 42
✅ Выполнено: 38
📊 Completion Rate: 90%

🔥 АКТИВНОСТЬ
🔥 Текущий streak: 7 дней
🏅 Лучший streak: 12 дней
📅 Дней в игре: 23

🏆 БЕЙДЖИ (3)
1. "Первый шаг" — создал первый квест
2. "Неутомимый" — 7 дней подряд
3. "Серийный киллер" — 25 квестов выполнено

⚙️ НАСТРОЙКИ
📱 Язык: Русский
🎨 Тема: Fantasy
🔔 Напоминания: 19:00 (ежедневно)
📅 Еженедельный отчет: Воскресенье

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[Статистика] [Настройки] [Друзья] [Выйти]
```

---

### УРОВЕНЬ 2: Продвинутые команды (Неделя 2)

#### /stats
**Описание:** Детальная статистика  
**Ответ:**
```
📊 ДЕТАЛЬНАЯ СТАТИСТИКА
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ЭТОЙ НЕДЕЛЕЙ:
Пн: 3 квеста | Вт: 5 кв | Ср: 2 кв | Чт: 0 кв | 
Пт: 4 кв | Сб: 6 кв | Вс: 7 кв (сегодня)

📈 График XP за неделю:
[🟩 250 XP]

Среднее в день: 27 XP
Наибольший прилив: Суббота (180 XP)

🏆 ПОПУЛЯРНЫЕ ЗАДАЧИ
1. "Помыть посуду" — 12 раз
2. "Позвонить маме" — 8 раз
3. "Упражнения" — 7 раз

⏱️ БЫСТРЫЕ ФАКТЫ
- Быстрее всего выполняла: Позвонить маме (2 мин)
- Медленнее всего: Уборка квартиры (45 мин)
- Средняя длительность: 20 мин

[Детали за месяц] [Очистить данные]
```

---

#### /leaderboard
**Описание:** Глобальный лидерборд топ-10 игроков  
**Ответ:**
```
🏆 ГЛОБАЛЬНЫЙ ЛИДЕРБОРД
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🥇 1. Мария         Ур. 8   1240 XP
🥈 2. Иван          Ур. 7   890 XP
🥉 3. Алена         Ур. 6   750 XP
4. Петр           Ур. 5   620 XP
5. 👤 ТЫ (Алекс)    Ур. 3   240 XP ← Ты здесь!
6. Оля            Ур. 3   230 XP
7. Сергей         Ур. 2   180 XP
8. Дарья          Ур. 2   150 XP
9. Никита         Ур. 1   120 XP
10. Ева           Ур. 1   100 XP

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📈 Твой прогресс: ↑3 места за неделю
Нужно +380 XP, чтобы попасть в топ-3

[Еженедельный] [Ежемесячный] [Друзья]
```

---

#### /daily
**Описание:** Ежедневный специальный челлендж  
**Ответ:**
```
🌟 ЕЖЕДНЕВНЫЙ ЧЕЛЛЕНДЖ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📜 Сегодняшний челлендж: "День продуктивности"
Описание: Выполни 5+ квестов сегодня

🎁 Награда: +50 XP (обычно за 5 квестов +75 XP)

Прогресс: 3/5 ✅ ✅ ✅ ⬜ ⬜

Осталось: 2 квеста для завершения!

[Добавить квест] [Отклонить челлендж]
```

**Может быть новый каждый день:**
- День продуктивности (5+ квестов)
- День здоровья (хотя бы 1 фитнес-квест)
- День семьи (позвонить/встретиться с близкими)
- День творчества (2+ творческих задачи)

---

#### /leaderboard_friends
**Описание:** Лидерборд среди друзей  
**Условие:** Должен быть хотя бы 1 друг  
**Ответ:**
```
👥 ЛИДЕРБОРД СРЕДИ ДРУЗЕЙ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 🥇 Мария        Ур. 8   1240 XP
2. 🥈 Петр         Ур. 5   620 XP
3. 🥉 👤 ТЫ (Алекс) Ур. 3   240 XP
4.    Оля          Ур. 3   230 XP
5.    Сергей       Ур. 2   180 XP

[Все пользователи] [Добавить друга]
```

---

#### /friend_add [username]
**Описание:** Добавить пользователя в друзья  
**Примеры:**
```
/friend_add maria
/friend_add @ivan_quest
```

**Ответ при успехе:**
```
✅ Мария добавлена в друзья!

👤 Мария
🎖️ Уровень: 8
⭐ XP: 1240
🏆 Бейджи: 7 шт
🔥 Streak: 15 дней

[Профиль] [Вызвать на челлендж] [Удалить]
```

**Ошибки:**
```
❌ /friend_add вася
"❌ Пользователь 'вася' не найден. 
Может быть, вы имели в виду:
- @vasya_games
- @vasily_quest"
```

---

#### /invite
**Описание:** Получить реферальную ссылку  
**Ответ:**
```
👥 ПРИГЛАСИ ДРУЗЕЙ!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Твоя реферальная ссылка:
https://t.me/daily_quest_bot?start=ref_user123

🎁 ЗА КАЖДОГО ДРУГА:
- Ты получаешь: +50 XP + "Социальный мотылек"
- Друг получает: +20 XP стартовый бонус

👥 Пригласенные друзья: 3

[Скопировать ссылку] [Поделиться в ТГ]
```

---

### УРОВЕНЬ 3: Системные команды

#### /help
**Описание:** Справка по командам  
**Ответ:**
```
❓ СПРАВКА ПО КОМАНДАМ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📝 УПРАВЛЕНИЕ КВЕСТАМИ:
/addtask [описание] — создать новый квест
/quests — список текущих квестов
/done [номер] — отметить выполненным

👤 ПРОФИЛЬ И ПРОГРЕСС:
/profile — мой профиль
/stats — статистика

🏆 ОБЩЕСТВЕННОЕ:
/leaderboard — глобальный лидерборд
/daily — ежедневный челлендж
/friend_add [пользователь] — добавить друга
/leaderboard_friends — среди друзей
/invite — реферальная ссылка

⚙️ ПРОЧЕЕ:
/settings — настройки
/feedback — отправить отзыв
/help — эта справка
/cancel — отмена

💡 ПОДСКАЗКА:
Активно играй, чтобы открыть новые темы и функции!

[Главное меню]
```

---

#### /settings
**Описание:** Настройки пользователя  
**Ответ:**
```
⚙️ НАСТРОЙКИ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔔 УВЕДОМЛЕНИЯ
Напоминания: ✅ ВКЛ  [Выключить]
Время: 19:00 [Изменить]
Еженедельный отчет: ✅ Воскресенье [Отключить]

🎨 ТЕМА
Текущая: Fantasy [Изменить]
Доступные: Fantasy, Sci-Fi (открыть на Ур. 5)

🌍 ЯЗЫК
Текущий: Русский [Изменить на English]

🔐 КОНФИДЕНЦИАЛЬНОСТЬ
Профиль видно всем: ✅ [Только друзьям] [Приватный]
На лидерборде: ✅ [Скрыть]
Данные здоровья: 🔒 Зашифрованы

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[Сохранить] [Отмена] [Главное меню]
```

---

#### /feedback
**Описание:** Отправить отзыв или найденную ошибку  
**Примеры:**
```
/feedback Сюжеты слишком короткие
/feedback Нашел баг: квест не сохраняется
```

**Ответ:**
```
💬 ОБРАТНАЯ СВЯЗЬ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Спасибо! 🙏 Твое мнение очень важно для нас.

Твой отзыв:
"Сюжеты слишком короткие"

📨 Отправлено разработчикам!
Ты получишь ответ в течение 24 часов.

[Отправить еще] [На главное меню]
```

---

#### /cancel
**Описание:** Отмена текущей операции  
**Результат:** Возврат в главное меню  

---

## Часть 2: Сценарии использования

### Сценарий 1: НОВЫЙ ПОЛЬЗОВАТЕЛЬ

```
Временная шкала: День 1-3

1️⃣ День 1, 10:00
   Юзер: /start
   Бот: Приветствие, инструкция
   Юзер получает: Первый квест (Бейдж "Первый шаг")

2️⃣ День 1, 14:00
   Юзер: /addtask Помыть посуду
   Бот: Генерирует сюжет
   Юзер: Читает, потом [Выполнено]
   Бот: +10 XP, уровень остается 1

3️⃣ День 1, 18:00
   Юзер: /addtask Позвонить маме
   Юзер: /addtask Упражнения
   Юзер: /done 2, /done 3
   Бот: +20 XP за позвонить, +15 за упражнения
   Бот: Всего за день: 45 XP (15% к уровню 2)

4️⃣ День 1, 19:00
   Бот автоматически: "📭 Осталось еще 1 квест 
                       до бонуса в +10 XP!"

5️⃣ День 2, 10:00
   Напоминание: "У тебя 3 невыполненных квеста! 📋"

6️⃣ День 2
   Юзер активно создает и выполняет квесты
   Когда достигает 45+30=75 XP:
   Бот: "🎉 Поздравляем! Ты повысился до Уровня 2!"

7️⃣ День 3, 19:00
   Юзер: /profile
   Видит: Уровень 2, streak 2 дня, 3 бейджа
   Мотивирован продолжать
```

### Сценарий 2: ОПЫТНЫЙ ПОЛЬЗОВАТЕЛЬ (Неделя 2-3)

```
Пользователь: Мария (Уровень 5, 23 дня в игре)

1️⃣ Ежедневная активность
   Утро: /daily (выполняет ежедневный челлендж)
   День: /addtask (3-5 новых квестов)
   Вечер: /profile + /leaderboard (смотрит прогресс)

2️⃣ Еженедельно (Воскресенье)
   Получает: Еженедельный отчет с статистикой
   "📊 На неделе ты выполнил 35 квестов, 280 XP.
    Лучший день: Суббота. Текущий streak: 14 дней!"

3️⃣ Социальный контент
   Периодически: /leaderboard_friends
               /invite (пригласила 5 друзей)
   Участие в косвенной конкуренции

4️⃣ Новые функции
   Достигла Уровня 5: Открылась тема "Sci-Fi"
   Переключилась на новую тему
   Новые сюжеты генерируются в стиле Sci-Fi
```

### Сценарий 3: ВОЗВРАТ НЕАКТИВНОГО ПОЛЬЗОВАТЕЛЯ

```
Юзер: Петр (был активен, потом пропал на 5 дней)

1️⃣ День 6 (возврат)
   Юзер: /start
   Бот: "Добро пожаловать обратно! 👋
        Твой streak был сброшен (5 дней неактивности),
        но уровень сохранен: Уровень 3"

2️⃣ День 6
   Юзер: /stats
   Видит: Статистика за время отсутствия (никакие)
   Мотивирующее сообщение: "Давай восстановим твой streak!"

3️⃣ День 6-12
   Интенсивная переиграция
   Streak восстанавливается: 1, 2, 3, 4... дней подряд
   Бот: Регулярные поздравления за восстановление

4️⃣ День 13
   Бейдж: "Возрождение" (вернулся после перерыва)
```

---

## Часть 3: Интеграция inline кнопок

### Inline кнопки в Telegram

```
Кнопки встраиваются в каждое сообщение:

Форма: [🟦 Кнопка 1] [🟦 Кнопка 2]

Примеры:

1. После создания квеста:
   [Выполнено] [Отмена] [Деталь]

2. В профиле:
   [Статистика] [Настройки] [Друзья]

3. В лидерборде:
   [Еженедельный] [Ежемесячный] [Друзья]

4. После выполнения квеста:
   [Добавить новый] [Мой прогресс] [Главное меню]

Техническая реализация (Telegraf):
├─ Inline Keyboard (встроенные кнопки)
├─ Reply Keyboard (внизу у клавиатуры)
└─ Web App (для интеграции с веб-приложением позже)

Преимущества:
✓ Быстро выполнять действия без ввода команд
✓ Красивый UI
✓ Избежать ошибок при вводе

Недостатки:
✗ Ограничение по количеству кнопок
✗ Слишком много кнопок = растущий UI
```

---

## Часть 4: Система обработки ошибок

### Типичные ошибки

```
ОШИБКА #1: Пустой ввод в /addtask
Сообщение: ❌ Пожалуйста, опиши задачу (от 5 до 200 символов)
Действие: Повторный запрос

ОШИБКА #2: Слишком длинный текст (>200 символов)
Сообщение: ❌ Описание слишком длинное (макс 200 символов)
Действие: Попросить сократить

ОШИБКА #3: ChatGPT недоступен (timeout)
Сообщение: ⏳ Генерирую... может занять 10 сек
Действие: Повторная попытка, затем fallback

ОШИБКА #4: Нежелательный контент от AI
Сообщение: ❌ Не удалось сгенерировать квест. Попробуй другое описание.
Действие: Запрос с более строгим фильтром

ОШИБКА #5: Database error
Сообщение: ⚠️ Техническая ошибка. Попробуй позже.
Действие: Логирование, алерт администратору

ОШИБКА #6: Недостаточно прав (например, /done чужого квеста)
Сообщение: ❌ Ты не можешь отметить чужой квест!
Действие: Блокировка, совет создать свой

ОШИБКА #7: API Rate Limit (слишком много запросов)
Сообщение: 🕐 Слишком много запросов. Подождите 60 сек.
Действие: Queue система, задержка
```

---

## Часть 5: Точки интеграции данных

### Firebase Firestore transactions

```
Когда пользователь выполняет квест (/done):

1. START TRANSACTION
2. CHECK: Квест существует? Не выполнен еще?
3. UPDATE quest: completed = true, completedAt = now()
4. UPDATE user: xp += quest.xp
5. CHECK: повысился ли уровень?
   ЕСЛИ ДА:
   - UPDATE user: level += 1
   - CREATE achievement/notification
6. CHECK: выполнено N квестов подряд? Обновить streak
7. CHECK: 3+ квеста в день? Добавить дневной бонус +10 XP
8. LOG: создать запись в analytics
9. COMMIT TRANSACTION

ЕСЛИ на любом шаге ошибка:
   ROLLBACK (откатить все)
   Пользователю: "Ошибка сохранения. Попробуйте еще раз"
```

### Асинхронные действия (Bull Queue)

```
Очередь задач для напоминаний:

Job 1: Ежедневное напоминание (19:00)
├─ Триггер: каждый день в 19:00
├─ Действие: отправить боту сообщение
│          "У тебя X невыполненных квестов!"
└─ Хранение: пользовательское время из settings

Job 2: Еженедельный отчет (Воскресенье 19:00)
├─ Триггер: каждое воскресенье
├─ Действие: отправить статистику за неделю
└─ Хранение: только если включено в settings

Job 3: Напоминание о новых темах (Ур. 5)
├─ Триггер: когда юзер поднялся до Уровня 5
├─ Действие: "Откроются новые темы: Sci-Fi, Cyberpunk!"
└─ Одноразовая отправка
```

---

## Итоговая таблица команд

| Команда | Тип | Неделя | Сложность | Примечание |
|---------|-----|--------|-----------|-----------|
| `/start` | базовая | 1 | ⭐ | Регистрация |
| `/addtask` | базовая | 1 | ⭐ | ChatGPT интеграция |
| `/quests` | базовая | 1 | ⭐ | Список активных |
| `/done` | базовая | 1 | ⭐ | Завершение квеста |
| `/profile` | базовая | 1 | ⭐⭐ | Профиль + статистика |
| `/stats` | расширенная | 2 | ⭐⭐ | Детальная статистика |
| `/leaderboard` | расширенная | 2 | ⭐⭐ | Глобальный ТОП |
| `/daily` | расширенная | 2 | ⭐⭐ | Ежедневный челлендж |
| `/friend_add` | социальная | 2 | ⭐⭐ | Добавить друга |
| `/leaderboard_friends` | социальная | 2 | ⭐⭐ | Среди друзей |
| `/invite` | социальная | 2 | ⭐ | Реферальная ссылка |
| `/settings` | системная | 2 | ⭐⭐⭐ | Настройки пользователя |
| `/help` | системная | 1 | ⭐ | Справка |
| `/feedback` | системная | 2 | ⭐ | Обратная связь |
| `/cancel` | системная | 1 | ⭐ | Отмена операции |

---

**Эти сценарии и команды готовы к реализации на Node.js + Telegraf! 🚀**
